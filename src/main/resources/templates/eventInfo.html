<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
	<head>
	    <title>Información del Evento</title>
	    <meta charset="UTF-8">
		<link rel="stylesheet" href="/css/styles.css">
	    <!-- Bootstrap CDN -->
	    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	</head>
	<body>
		<!-- Nav Menu -->
        <div th:replace="~{fragments/navMenu :: navMenu}"></div>
			
		<div class="container mt-5">
			<!-- Información general -->
			<div style="display: flex; gap: 2rem; margin-bottom: 2rem;">
			  <!-- Imagen grande a la izquierda -->
			  <div style="flex: 1;">
			    <img th:src="@{'/img/event/' + ${event.imagen}}" 
			         alt="Imagen del evento" 
			         style="width: 100%; max-width: 500px; height: auto; border-radius: 1rem;">
			  </div>

			  <!-- Información a la derecha -->
			  <div style="flex: 1;">
			    <h1 th:text="${event.title}">Título del evento</h1>
			    <p><strong>Fecha:</strong><span th:text="${event.startDate}"></span> a <span th:text="${event.endDate}"></span></p>
			    <p><strong>Lugar:</strong> <span th:text="${event.ubication}"></span></p>
			    <p><strong>Descripción:</strong></p>
			    <p th:text="${event.description}">Descripción aquí</p>
				<p><strong>Aforo</strong>
					<span th:text="${event.numParticipants}"></span>
					/
					<span th:text="${event.maxCapacity}"></span></p>

				<div class="my-3">
					<p><strong>Categorías:</strong> 
				    <span class="badge bg-primary" th:each="cat : ${event.categories}" th:text="${cat.category.name}">Sin categoría</span>
				</div>
			  </div>
			</div>

			 <!-- Para Participantes -->
			<div sec:authorize="hasRole('PARTICIPANTE')">
			  <h2>Actividades</h2>
			  <ul>
			    <li th:each="activity : ${event.activities}" th:text="${activity.name}">Nombre de actividad</li>
			  </ul>
			</div>
		   
		    <div sec:authorize="hasRole('PARTICIPANTE')">
		        <div th:if="${!event.participants.contains(user)}">
		            <form th:action="@{/event/join/{id}(id=${event.id})}" method="post">
		                <button type="submit" class="btn btn-success">Inscribirse</button>
		            </form>
		        </div>
		        <div th:if="${event.participants.contains(user)}">
					<form th:action="@{/event/leave/{id}(id=${event.id})}" method="post">
		                <button type="submit" class="btn btn-success">Desinscibirse</button>
		            </form>
		        </div>
		    </div>
		
		    <!-- Para Organizadores -->
		    <div sec:authorize="hasRole('ORGANIZADOR')" th:if="${owner}">
		
		        <h3 class="mt-4">Gestión del Evento</h3>
		
		        <a th:href="@{/event/edit/{id}(id=${event.id})}" class="btn btn-warning mb-3">Editar evento</a>
		
		        <h4>Participantes inscritos:</h4>
		        <ul class="list-group mb-4">
					<li class="list-group-item" th:if="${#lists.isEmpty(event.participants)}">No hay participantes actualmente</li>
		            <li class="list-group-item" th:each="participant : ${event.participants}" th:text="${participant.username}">Usuario</li>
		        </ul>
		
		        <h4>Actividades</h4>
		        <ul class="list-group">
		            <li class="list-group-item" th:each="activity : ${event.activities}">
		                <strong th:text="${activity.name}">Nombre</strong> - 
		                <span th:text="${activity.description}">Descripción</span>
		            </li>
		        </ul>
		        <a th:href="@{/activity/manage/{id}(id=${event.id})}" class="btn btn-secondary mt-3">Gestionar Actividades</a>
		    </div>
		</div>
	</body>
</html>
